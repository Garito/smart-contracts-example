## Описание
Это пример рынка токенов.

Владелец токенов производит первоначальную эмиссию определенного количества токенов, которые зачисляются на его
 кошелек. В дальнейшем он может производит новые эмиссии токенов в чью-то пользу (`CustomToken.emission(receiver, amount)`), о чем будут 
 оповещаться все желающие это знать (`event Emission(uint256 amount)`).

Владелец рынка организовывает продажу токенов между участниками. Он устанавливает размер комиссии (`SellOffer.setFee(fee)`), которая будет 
сниматься с покупателя за покупку токенов в пользу рынка. Также он может вывести часть "заработанных" рынком средств на свой кошелек 
(`SellOffer.withdraw(amount)`). Кроме того владелец рынка может закрыть рынок с возвращенеи всех не проданных токенов их обладателям и 
выводом всех "заработанных" средств на свой кошелек (`SellOffer.destroy()`).

Любой участник рынка может просмотреть общее количество предложений на рынке (`SellOffer.getAllSellOffersCount()`), количество своих 
предложений (`SellOffer.getMySellOffersCount()`) и текущий размер комиссии (`SellOffer.fee()`). Также он может выбрать любое предложение по 
его номеру (`SellOffer.getSellOffer(index)`) и совершить сделку по номеру предложения перечислив в этой же транзакции достаточное 
количество средств (`SellOffer.buy(index)`). При необходимости рынок вернет сдачу.
 
Обладатель токенов может создать предложение о продаже, указав количество и цену в wei (1 ether * 10^-18) (`SellOffer.createSellOffer
(amount, price)`). Для этого перед размещение самого предложения ему необходимо создать разрешение чтобы контракт рынка смог снять с его 
кошелька определенное количество токенов (`CustomToken.approve(spender, value)`). Разместивший предложение может его отменить с 
возвращеним токенов без комиссии рынка на свой кошелек (`SellOffer.cancel(index)`).

## Необходимые компоненты
 - Необходимо установить клиент сети Ethereum - Geth (https://geth.ethereum.org/downloads).
 - Для размещения контрактов в сети на выбор можно установить Mist (https://github.com/ethereum/mist/releases), Truffle 
 (http://truffleframework.com) или и то и другое.

## Настройка компонентов

### Запуск ноды сети
В терминале запустим Geth и укажем чтобы Geth использовал приватную тестовую сеть Ethereum:
- geth --dev --rpc --rpccorsdomain="*" --rpcaddr "0.0.0.0" --rpcapi "admin,debug,miner,shh,txpool,personal,eth,net,web3" console

### Настройка Mist
Во отдельном терминале запустим Mist и укажем чтобы Mist использовал не встроенный клиент сети Ethereum: 
- mist --rpc http://localhost:8545

### Настройка Truffle
Для настройки Truffle необходимо отредактировать файл truffle.js

```module.exports = {
  networks: {
    development: {
      host: "localhost",
      port: 8545,
      network_id: "*" // Match any network id
    }
  }
};
```
### Создание майнера 
Для того чтобы создать аккаунт в терминале Geth нужно выполнить команду 
- personal.newAccount("password").
 
Для того чтобы создать аккаунт в Mist нужно нажать сооветствующую кнопку. 

Первый созданный аккаунт будет автоматически назначен майнером.

За размещение контрактов необходимо платить комиссию за проведение транзакции в блокчейне, поэтому необходимо запустить майнер. Для этого
 в терминале Geth необходимо выполнить команду:
- miner.start()

Чтобы остановить майнинг:
- miner.stop()

## Размещение контрактов
Для проведение всех транзакций, размещение и вызов контрактов (кроме статических) необходимо чтобы работал майнер.

1) Размещается контракт Dispatcher
2) Размещается контракт CustomToken с указанием имени токена, его символа, количество дробных порядков и величиной первоначальной эмиссии
3) Адрес размещенного контракта CustomToken назначается в Dispatcher от 
имени аккаунта, разместивший сам Dispatcher
4) Размещается контракт SellOffer с указанием адреса размещенного ранее контракта Dispatcher

### Размещение с помощью Mist
Для размещения контрактов в Mist необходимо перейти в соответствующий раздел, далее:
- выбрать аккаунт от имени которого будет происходить размещение,
- при необходимости указать количество средств перечисляемых на контракт,
- вставить исходный код,
- выбрать имя контракта,
- указать параметры конструктора,
- указать размер комиссии,
- нажать кнопку размещения и указать пароль от размещающего аккаунта

Так как Mist не умеет производить импорт, то вместо него необходимо вставлять либо весь код импортируемого контракта либо его абстрактный
 аналог (если будет использоваться его реализация, которая ранее была размещена в блокчейне)
 
### Размещение с помощью Truffle
Для размещения контрактов с помощью Truffle необходимо создать соответсвующие миграционные файлы:
- 1_initial_migration.js
```
var Migrations = artifacts.require("./Migrations.sol");

module.exports = function(deployer) {
  deployer.deploy(Migrations);
};
```
- 2_deploy_contracts.js
```
var Dispatcher = artifacts.require("./Dispatcher.sol");
var CustomToken = artifacts.require("./token/CustomToken.sol");
var SellOffer = artifacts.require("./market/SellOffer.sol");

module.exports = function(deployer) {
  deployer.deploy(Dispatcher);
  deployer.deploy(CustomToken).then(function() {
    Dispatcher.deployed().then(function(instance) {
      return instance.setCurrentCustomTokenAddress(CustomToken.address);
    }).then(function(result) {
      deployer.deploy(SellOffer, Dispatcher.address);
    });
    return;
  });
};
```
- etc.

Затем в терминале Geth необходимо разблокировать аккаунт, от лица которого будет выполняться размещение контратков и ввести пароль:
- personal.unlockAccount("account_address")

После чего в терминале из директории проекта необходимо выполнить команду:
- truffle migrate